/*
 a delayed logger, that allows the app-loader to log to console before
 the logging app is initialized, and then logs to winston.
 */
var moonshine = require("./index.js")

var lograpLogger = false
var queue = []
function getLogger() {
    if (!lograpLogger && moonshine.logFactory) {
        lograpLogger = moonshine.logFactory("moonshine.appLoader")
        queue.forEach(function(item){
            lograpLogger[item[0]].call(lograpLogger,item[1])
        })
        queue = []
    }
    return lograpLogger;
}

module.exports.logger = {
    debug:function(){
        var args = Array.prototype.slice.call(arguments,0)
        if (getLogger()) {
            getLogger().debug.apply(getLogger(),args)
        }
        queue.push(["debug",args])
    },
    info:function(){
        var args = Array.prototype.slice.call(arguments,0)
        if (getLogger()) return getLogger().info.apply(getLogger(),args)
        queue.push(["info",args])
    },
    error:function(){
        var args = Array.prototype.slice.call(arguments,0)
        if (getLogger()) return getLogger().error.apply(getLogger(),args)
        queue.push(["error",args])
    }
};
function logOnExit(){
    if (!moonshine.logFactory) {
        queue.forEach(function(item){
            console.log(item[0] + ": " + item[1][0])
            if (item[1].length > 1) {
                for (var i=1; i < item[1].length;i++) {
                    console.log(item[1][i])
                }
            }
        })
    }
}
process.on("exit",logOnExit);

