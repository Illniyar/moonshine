var moonshine = require("moonshine-core"),
    settings = moonshine.settings,
    logger = moonshine.logFactory(),
    http = require('http');

function RunServer(){

}
RunServer.prototype.execute = function(args,cb){
    try {
        var httpServer =moonshine.server.httpServer =http.createServer(moonshine.server.app)
        httpServer.on("listening",function(){
            logger.info("Server listening on port %d in %s modes",httpServer.address().port,settings.environment.join(","))
            moonshine.server.shutdown = function(done){
                moonshine.server.httpServer.close(function(err){
                    if (err)return done(err)
                    moonshine.signal("server.shutdown",[],done)
                })
            }
            moonshine.signal("server.started",[],cb)
        })
        httpServer.on("error",function(err){
            logger.error("could not start server, got exception binding address",err);
            cb(err)
        })
        httpServer.listen(settings.SERVER_PORT)
    } catch(e){
        cb(e)
    }
}

module.exports = RunServer